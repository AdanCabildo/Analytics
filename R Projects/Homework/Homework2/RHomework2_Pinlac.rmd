---
title: R Homework 2
author: Mattthew Aaron A. Pinlac
output: html_document
---

Here are some libraries that you may need.
```{r}
library(ggplot2)
library(plyr)
library(reshape2)
library(Hmisc)
library(dplyr)
library(tidyr)
```

You should always
1. when plotting categorical data, consider whether the default ordering is best
2. label the axes and title, adjust the tick labels so they are legible, etc.

Note: For some reason my version of R started insisting that I use "summarise" (with the British spelling) instead of "summarize". So you might want to check on this in case a similar thing happens in your system.

Problem 1: Look at the `moviesA.csv` dataset which is given to you together with this RMD file. Make a bar chart that shows how many movies per year are in the data set, for the years 1900-1920.

Note: If you see a message that `binwidth defaulted to range/30`, then you are making a **histogram**, not a bar chart. Convert the `year` column to a factor to prevent this.

You will need to adjust the x axis labels so they are readable.

```{r fig.width=10, fig.height=3, dpi=100, fig.align='center'}
# Load the dataset
movies=read.csv("moviesA.csv")

# Filters the dataset for the years 1900-1920 and count the number of movies per year
filteredmovies=subset(movies, year >= 1900 & year <= 1920)
movie_num=table(filteredmovies$year)
movie_numdf=data.frame(year = as.numeric(names(movie_num)), Count = as.numeric(movie_num))

# Creates a bar chart using ggplot2
ggplot(movie_numdf, aes(x = as.factor(year), y = Count)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Number of Movies per Year (1900-1920)", x = "Year", y = "Number of Movies")
```

Problem 2: Create a dot chart that shows how many movies per year are in the data set, for all years. Use `stat_summary` with `fun.y=length` to do this. 

Compare the difference when the `year` variable is treated as a factor or as a number. Which do you think makes the better plot?

```{r fig.width=10, fig.height=3, dpi=100, fig.align='center'}

# Creates a dot chart treating year as a factor
ggplot(movies, aes(x = as.factor(year))) +
  stat_summary(fun.y = "length", geom = "point", aes(y = year)) +
  labs(title = "Number of Movies per Year (Year as Factor)", x = "Year", y = "Number of Movies")

# Creates a dot chart treating year as a number
ggplot(movies, aes(x = as.numeric(year))) +
  stat_summary(fun.y = "length", geom = "point", aes(y = year)) +
  labs(title = "Number of Movies per Year (Year as Numeric)", x = "Year", y = "Number of Movies")
```
In problem number 2, I prefer treating the "Year" variable as a number rather than a factor. This approach makes the visualization look cleaner and easier to understand. By representing the "Year" variable as a number in the dot chart, the visual representation of the count of movies for each year becomes more straightforward and easier to interpret. This choice helps to present the data clearly, making it easier for viewers to grasp the information in the chart.



Problem 3: Use the commands `stat_summary` and `geom_pointrange` to show the average ratings per year, +/- 95% confidence intervals, for all years. You can use the command `mean_cl_boot()` to compute the mean and CI's automatically.

```{r fig.width=10, fig.height=3, dpi=100, fig.align='center'}

# Handling missing values and creating the plot
ggplot(na.omit(movies), aes(x = year, y = rating)) +
  stat_summary(fun.data = "mean_cl_boot", geom = "pointrange") +
  labs(title = "Ratings of Movies per Year", x = "Year", y = "Ratings")

```

Problem 4a: Create a line chart that shows the number of movies per year and per genre (Action, Animation, Comedy, Drama, Documentary, Romance, and Short). If a movie has multiple genres, then it should be counted in each one.

Hint: You can use the `melt()` command and then do a `subset()` to get the data into the form that you need.

```{r fig.width=10, fig.height=3, dpi=100, fig.align='center'}

# Reshape the data
movies_melt=melt(movies, id.vars=c("year"), measure.vars=c("Action", "Animation", "Comedy", "Drama", "Documentary", "Romance", "Short"))

# Subset the data to include only rows where the genre indicator is 1
movies_subset=subset(movies_melt, value == 1)

# Count the occurrences of each genre per year
genre_counts=aggregate(value ~ year + variable, data= movies_subset, FUN=length)
colnames(genre_counts) = c("year", "genre", "count")

# Plot the line chart
ggplot(genre_counts, aes(x = year, y = count, color = genre, group = genre)) +
  geom_line() +
  labs(title = "Number of Movies per Year and Genre",
       x = "Year",
       y = "Number of Movies",
       color = "Genre") +
  theme_minimal()
```

Problem 4b: Remake the same plot, but as a stacked area chart. This is done by using `geom='area'`, and then `position='stack'`, inside the call to stat_summary. (you'll also want to use `fill` instead of `color` most likely)

```{r fig.width=10, fig.height=3, dpi=100, fig.align='center'}
# Reshape the data from wide to long format
movies_melted=melt(movies, id.vars=c("year"), measure.vars=c("Action", "Animation", "Comedy", "Drama", "Documentary", "Romance", "Short"))

# Subset the data to include only rows where the genre indicator is 1
movies_subset=subset(movies_melted, value == 1)

# Count the occurrences of each genre per year
genre=aggregate(value ~ year + variable, data=movies_subset, FUN=length)
colnames(genre) = c("year", "genre", "count")

# Plot the stacked area chart
ggplot(genre, aes(x = year, y = count, fill = genre)) +
  geom_area(position = "stack") +
  labs(title = "Number of Movies per Year and Genre",
       x = "Year",
       y = "Number of Movies",
       fill = "Genre") +
  theme_minimal()
```

Problem 5: Choose the 5 most common genres in the data set, and make a line chart showing the average ratings per year and genre. 

```{r fig.width=6, fig.height=3, dpi=100, fig.align='center'}
# Find the 5 most common genres

top_genres=movies %>%
  select(Action, Animation, Comedy, Drama, Documentary, Romance, Short) %>%
  summarise_all(list(~sum(. > 0))) %>%
  gather(key = "genre", value = "count") %>%
  arrange(desc(count)) %>%
  head(5) %>%
  pull(genre)

# Reshape the data and calculate average ratings per year and genre for the top genres
ratings=movies %>%
  select(year, rating, all_of(top_genres)) %>%
  gather(key = "genre", value = "has_genre", -year, -rating) %>%
  filter(has_genre > 0) %>%
  group_by(year, genre) %>%
  summarise(avg_rating = mean(rating, na.rm = TRUE))

# Plot the line chart
ggplot(ratings, aes(x = year, y = avg_rating, color = genre, group = genre)) +
  geom_line() +
  labs(title = "Average Ratings per Year and Genre",
       x = "Year",
       y = "Average Rating",
       color = "Genre") +
  theme_minimal()
```

